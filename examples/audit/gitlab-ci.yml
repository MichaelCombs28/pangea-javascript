.example_audit_base:
  image: node
  before_script:
    - cd examples/audit
    - npm ci --legacy-peer-deps
  cache:
    - key:
        files:
          - package-lock.json
      paths:
        - node_modules

test_example_audit_app:
  extends: .example_audit_base
  image: cypress/browsers:node18.12.0-chrome103-ff107
  stage: Integration Test
  script:
    - wget -qO - https://dl.google.com/linux/linux_signing_key.pub | sudo gpg --dearmor -o /usr/share/keyrings/googlechrome-linux-keyring.gpg
    - echo "deb [arch=amd64 signed-by=/usr/share/keyrings/googlechrome-linux-keyring.gpg] http://dl.google.com/linux/chrome/deb/ stable main" | sudo tee /etc/apt/sources.list.d/google-chrome.list
    - sudo apt update
    - sudo apt install -y google-chrome-stable
    - npm run cypress:info
    - npm run cypress:ci
  artifacts:
    when: always
    paths:
      - cypress/videos/**/*.mp4
      - cypress/screenshots/**/*.png
    expire_in: 1 day
